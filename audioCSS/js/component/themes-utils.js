(function () {
    var ThemesUtils = {};

    ThemesUtils.toggleNavigationPanel = function () {
        if (!window.NavigationPanel)
            return;

        if (window.innerWidth <= NavigationPanel.cpCollapseAtWindowInnerWidth) {
            if (!NavigationPanel.GetVisible())
                NavigationPanel.SetVisible(true);
            NavigationPanel.Toggle();
        } else {
            NavigationPanel.SetVisible(!NavigationPanel.GetVisible());
            ASPx.GetControlCollection().ProcessControlsInContainer(document.getElementById('DemoArea'), function (control) {
                control.AdjustControl();
            });
        }
        ThemesUtils.adjustDemoSettingsBlock();
    };
    ThemesUtils.toggleThemeSettingsPanel = function () {
        if (!window.ThemeSettingsPanel)
            return;
        ThemeSettingsPanel.Toggle();
    };

    ThemesUtils.CurrentThemeCookieKey = "DXCurrentTheme";
    ThemesUtils.CurrentBaseColorCookieKey = "DXCurrentBaseColor";
    ThemesUtils.CurrentAdaptiveThemeCookieKey = "DXCurrentAdaptiveTheme";
    ThemesUtils.CurrentAdaptiveBaseColorCookieKey = "DXCurrentAdaptiveBaseColor";
    ThemesUtils.CurrentFontCookieKey = "DXCurrentFont";

    ThemesUtils.SetCurrentAdaptiveTheme = function (theme) {
        ASPxClientUtils.SetCookie(ThemesUtils.CurrentAdaptiveThemeCookieKey, theme);
        forceReloadPage();
    }
    ThemesUtils.SetCurrentTheme = function (theme) {

        AjaxStandartCall("ChangeDevExpressTheme", '', theme, null);

        ASPxClientUtils.SetCookie(ThemesUtils.CurrentThemeCookieKey, theme);
        forceReloadPage();
    }

    ThemesUtils.OnShowAllThemesClick = function () {

        var themesListsNames = ShowAllThemesButton.cpThemesListsNames;

        for (var i = 0; i < themesListsNames.length; i++) {
            var themesList = window[themesListsNames[i]];
            themesList.SetVisible(!themesList.GetVisible());
        }

        var showAllThemesText = LangInf.GNL.ShowAllThemes;
        var showTopThemesText = LangInf.GNL.ShowTopThemes;

        ShowAllThemesButton.SetText(ShowAllThemesButton.GetText() != showAllThemesText ? showAllThemesText : showTopThemesText);
    }
    ThemesUtils.OnThemesListSelectedIndexChanged = function (sender) {
        var selectedThemeName = sender.GetSelectedItem().value;
        if (ShowAllThemesButton.cpCurrenTheme != selectedThemeName)
            ThemesUtils.SetCurrentTheme(selectedThemeName !== 'Default' ? selectedThemeName : '');
    }
    ThemesUtils.OnThemesListInit = function (sender) {
        var mainElement = sender.GetMainElement();
        var itemElements = Array.prototype.slice.call(mainElement.getElementsByClassName("item"), 0);
        var newItemElements = itemElements.filter(function (elem) {
            return sender.cpNewThemes.indexOf(elem.textContent.trim()) !== -1;
        });
        newItemElements.forEach(function (itemElement) {
            if (itemElement.className.indexOf("new-item") === -1)
                itemElement.className += " new-item";
        });
    },
        ThemesUtils.SetCurrentFont = function (font) {
            ASPxClientUtils.SetCookie(ThemesUtils.CurrentFontCookieKey, font);
            forceReloadPage();
        }
    ThemesUtils.SetCurrentAdaptiveBaseColor = function (color) {
        ASPxClientUtils.SetCookie(ThemesUtils.CurrentAdaptiveBaseColorCookieKey, color);
        forceReloadPage();
    }
    ThemesUtils.SetCurrentBaseColor = function (color) {
        ASPxClientUtils.SetCookie(ThemesUtils.CurrentBaseColorCookieKey, color);
        forceReloadPage();
    }
    forceReloadPage = function () {
        if (document.forms[0] && (!document.forms[0].onsubmit
            || (document.forms[0].onsubmit.toString().indexOf("Sys.Mvc.AsyncForm") == -1 && !document.forms[0].hasAttribute("data-ajax")))) {
            // for export purposes
            var eventTarget = document.getElementById("__EVENTTARGET");
            if (eventTarget)
                eventTarget.value = "";
            var eventArgument = document.getElementById("__EVENTARGUMENT");
            if (eventArgument)
                eventArgument.value = "";

            document.forms[0].submit();
        } else {
            window.location.reload();
        }
    }


    ThemesUtils.iconButtonClick = function (s, e) {
        if (e.buttonIndex === 0)
            s.Focus();
    }


    function selectorPopupContainerElement_Click(popupControl, event) {
        var eventSource = ASPx.Evt.GetEventSource(event);
        if (eventSource && eventSource.className.indexOf('dxpc-content') >= 0) {
            popupControl.HideWindow();
        }
    }
    function DXSelectorPopupContainer_Init(sender) {
        var content = sender.GetWindowContentElement(-1);
        ASPxClientUtils.AttachEventToElement(content, 'click', function (event) { selectorPopupContainerElement_Click(sender, event); });
    }

    function DXThemeSettingsPopupContainer_Init(sender) {
        var content = sender.GetWindowContentElement(-1);
        var themesButtonWrapper = content.querySelector(".themes-button-wrapper");
        // ASPxClientUtils.AttachEventToElement(themesButtonWrapper, 'click', function(event) { ThemeParametersPopup.Hide(); ThemeSelectorPopup.Show(); });
    }

    window.ThemesUtils = ThemesUtils;
    window.DXSelectorPopupContainer_Init = DXSelectorPopupContainer_Init;
    window.DXThemeSettingsPopupContainer_Init = DXThemeSettingsPopupContainer_Init;
})();
