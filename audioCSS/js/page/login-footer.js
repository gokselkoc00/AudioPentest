$(document).ready(function () {

    $(".tbx-username").focusin(function (e) {
        $(".icon-username").css("color", "#e20917");
        $(".icon-username-animate").css({
            "transform": "scale(3)",
            "opacity": "0",
            "color": "#e20917"
        });
    });

    $(".tbx-username").focusout(function (e) {
        $(".icon-username").css("color", "#495057");
        $(".icon-username-animate").css({
            "transform": "scale(1)",
            "opacity": "0.3",
            "color": "#343a40"
        });
    });

    $(".tbx-password").focusin(function (e) {
        $(".icon-password").css("color", "#e20917");
        $(".icon-password-animate").css({
            "transform": "scale(3)",
            "opacity": "0",
            "color": "#e20917"
        });
    });

    $(".tbx-password").focusout(function (e) {
        $(".icon-password").css("color", "#495057");
        $(".icon-password-animate").css({
            "transform": "scale(1)",
            "opacity": "0.3",
            "color": "#343a40"
        });
    });

    $(".tbx-email").focusin(function (e) {
        $(".icon-email").css("color", "#e20917");
        $(".icon-email-animate").css({
            "transform": "scale(3)",
            "opacity": "0",
            "color": "#e20917"
        });
    });

    $(".tbx-email").focusout(function (e) {
        $(".icon-email").css("color", "#495057");
        $(".icon-email-animate").css({
            "transform": "scale(1)",
            "opacity": "0.3",
            "color": "#343a40"
        });
    });

    $(".tbx-password1").focusin(function (e) {
        $(".icon-password").css("color", "#e20917");
        $(".icon-password-animate").css({
            "transform": "scale(3)",
            "opacity": "0",
            "color": "#e20917"
        });
    });

    $(".tbx-password1").focusout(function (e) {
        $(".icon-password").css("color", "#495057");
        $(".icon-password-animate").css({
            "transform": "scale(1)",
            "opacity": "0.3",
            "color": "#343a40"
        });
    });

    $(".tbx-password2").focusin(function (e) {
        $(".icon-password").css("color", "#e20917");
        $(".icon-password-animate").css({
            "transform": "scale(3)",
            "opacity": "0",
            "color": "#e20917"
        });
    });

    $(".tbx-password2").focusout(function (e) {
        $(".icon-password").css("color", "#495057");
        $(".icon-password-animate").css({
            "transform": "scale(1)",
            "opacity": "0.3",
            "color": "#343a40"
        });
    });

    CreatePasswordStrengthShecker();

    setTimeout(function () {

        var password = document.getElementById("tbxPassword1");
        var repassword = document.getElementById("tbxPassword2");

        if (password) {

            password.addEventListener("keyup", function () {
                let pass = document.getElementById("tbxPassword1").value;
                GetStrengthStatus(pass);
            });

            password.addEventListener("paste", function (s, e) {
                PastePassword(s, e);
            });

            password.addEventListener("change", function (s, e) {
                ValueChanged_Password(s, e);
            });

            repassword.addEventListener("change", function (s, e) {
                ValueChanged_RePassword(s, e);
            });
        }

    }, 1000);
});

var passwordStatus = false;

function EyeIcon_Click(passwordName) {

    if (!passwordStatus) {

        $(".eye-icon").removeClass("fa-eye");
        $(".eye-icon").addClass("fa-eye-slash");
        passwordStatus = true;
    }
    else {
        $(".eye-icon").removeClass("fa-eye-slash");
        $(".eye-icon").addClass("fa-eye");

        passwordStatus = false;
    }

    document.getElementById(passwordName).type = passwordStatus ? 'text' : 'password';
}

function CreatePasswordStrengthShecker() {

    var PasswordStrengthShecker = document.getElementById("TPnControl_PasswordStrengthShecker");

    if (PasswordStrengthShecker) {

        PasswordStrengthShecker.innerHTML = '' +
            '<div class="divPasswordStrengthShecker">' +
            '<ul class="list-unstyled">' +
            '<li class="">' +
            '<span class="low-upper-case"><i class="fas fa-circle" aria-hidden="true"></i>&nbsp;' + LangInf.APP.PasswordUpperCase + '</span></li>' +
            '<li class="">' +
            '<span class="one-number"><i class="fas fa-circle" aria-hidden="true"></i>&nbsp;' + LangInf.APP.PasswordNumber + '</span></li>' +
            '<li class="">' +
            '<span class="one-special-char"><i class="fas fa-circle" aria-hidden="true"></i>&nbsp;' + LangInf.APP.PasswordCustom + '</span></li>' +
            '<li class="">' +
            '<span class="eight-character"><i class="fas fa-circle" aria-hidden="true"></i>&nbsp;' + LangInf.APP.PasswordLenght + '</span></li>' +
            '</ul>' +
            '</div>';

        var ProgressBar = document.getElementById("TPnControl_ProgressBar");

        ProgressBar.innerHTML = '' +
            '<div id="popover-password">' +
            '<div class="progress"><div id="password-strength" class="progress-bar"  role="progressbar"  aria-valuenow="40" aria-valuemin="0"  aria-valuemax="100"  style="width:0%"></div>' +
            '</div>';
    }
}

function GetStrengthStatus(pass) {

    var passwordStrength = document.getElementById("password-strength");
    var lowUpperCase = document.querySelector(".low-upper-case i");
    var number = document.querySelector(".one-number i");
    var specialChar = document.querySelector(".one-special-char i");
    var eightChar = document.querySelector(".eight-character i");

    var progressBar = document.getElementById("TPnControl_ProgressBar");
    progressBar.style = 'display: unset;';

    let strength = 0;

    //If password contains both lower and uppercase characters
    if (pass.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)) {
        strength += 1;
        lowUpperCase.classList.remove('fa-circle');
        lowUpperCase.classList.add('fa-check');
    } else {
        lowUpperCase.classList.add('fa-circle');
        lowUpperCase.classList.remove('fa-check');
    }

    //If it has numbers and characters
    if (pass.match(/([0-9])/)) {
        strength += 1;
        number.classList.remove('fa-circle');
        number.classList.add('fa-check');
    } else {
        number.classList.add('fa-circle');
        number.classList.remove('fa-check');
    }

    //If it has one special character
    if (pass.match(/([!,%,&,@,#,$,^,*,?,_,~])/)) {
        strength += 1;
        specialChar.classList.remove('fa-circle');
        specialChar.classList.add('fa-check');
    } else {
        specialChar.classList.add('fa-circle');
        specialChar.classList.remove('fa-check');
    }

    //If password is greater than 7
    if (pass.length > 7) {
        strength += 1;
        eightChar.classList.remove('fa-circle');
        eightChar.classList.add('fa-check');
    } else {
        eightChar.classList.add('fa-circle');
        eightChar.classList.remove('fa-check');
    }

    // If value is less than 2
    if (strength < 2) {
        passwordStrength.classList.remove('progress-bar-warning');
        passwordStrength.classList.remove('progress-bar-success');
        passwordStrength.classList.add('progress-bar-danger');
        passwordStrength.style = 'width: 10%';
    } else if (strength == 3) {
        passwordStrength.classList.remove('progress-bar-success');
        passwordStrength.classList.remove('progress-bar-danger');
        passwordStrength.classList.add('progress-bar-warning');
        passwordStrength.style = 'width: 60%';
    } else if (strength == 4) {
        passwordStrength.classList.remove('progress-bar-warning');
        passwordStrength.classList.remove('progress-bar-danger');
        passwordStrength.classList.add('progress-bar-success');
        passwordStrength.style = 'width: 100%';
    }
}

function PastePassword(e) {

    var clipboardData, pastedData;

    clipboardData = e.clipboardData || window.clipboardData;

    pastedData = clipboardData.getData('Text')

    if (pastedData.length > 16) {

        e.stopPropagation();
        e.preventDefault();

        UyumNotifySpecial(LangErr.APP.ErrorPasswordLengtPaste, LangInf.GNL.ErrorTittle, 3, null, null, null, 7000);
    }
}

function ValueChanged_RePassword(s, e) {

    ControlPasswordAndRePassword();
}

function ValueChanged_Password(s, e) {

    if (ControlStrength()) {
        ControlPasswordAndRePassword();
    }
    else {
        UyumNotifySpecial(LangErr.APP.ErrorPasswordStrength, LangInf.GNL.ErrorTittle, 3, null, null, null, 7000);
    }
}

function ControlPasswordAndRePassword() {

    var pass = document.getElementById('tbxPassword1').value;
    var repass = document.getElementById('tbxPassword2').value;

    if (pass && repass) {

        if (pass != repass) {
            UyumNotifySpecial(LangErr.APP.ErrorPasswordNotMatch, LangInf.GNL.ErrorTittle, 3, null, null, null, 7000);
        }
    }
}

function ControlStrength() {

    var pass = document.getElementById('tbxPassword1').value;

    if (pass) {

        let strength = 0;

        //If password contains both lower and uppercase characters
        if (pass.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)) {
            strength += 1;
        }

        //If it has numbers and characters
        if (pass.match(/([0-9])/)) {
            strength += 1;
        }

        //If it has one special character
        if (pass.match(/([!,%,&,@,#,$,^,*,?,_,~])/)) {
            strength += 1;
        }

        //If password is greater than 7
        if (pass.length > 7) {
            strength += 1;
        }

        if (strength == 4) {

            return true;
        }
        else {
            return false;
        }
    }

    return true;
}