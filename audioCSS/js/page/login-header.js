$(document).ready(function () {

    ControlSSLRedirecs();

    ControlTryAgain();

    GetRememberMe();

    ControlLoginParent();

    $("#countries").msDropdown();

    $("#countries").change(function () {
        changeCountry($(this).val());
    });

});

function ControlSSLRedirecs() {

    var urlParams = new URLSearchParams(window.location.search);
    var sslParam = urlParams.get('ssl');

    if (sslParam == undefined || sslParam == null || sslParam == true) {

        var url = location.href;

        if (url.search('eko.uyumcloud.com') > -1 || url.search('erp.uyumcloud.com') > -1 || url.search('smmm.uyumcloud.com') > -1) {

            if (location.protocol !== 'https:') {
                location.replace(`https:${url.substring(location.protocol.length)}`);
            }
        }
    }
}

function ControlTryAgain() {

    var urlParams = new URLSearchParams(window.location.search);
    var myParam = urlParams.get('SessionState');

    if (myParam == "TryAgain") {

        UyumNotifySpecial("Hazır olduğunda giriş ekranına otomatik yönlendirileceksiniz", "Sistem Hazırlanıyor", 1, null, null, null, 10000);

        startLoading();

        setTimeout(function () {
            console.log("Sistem hazırlanıyor lütfen bekleyin.");
            location = "login.aspx";
        }, 10000);
    }
}

function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

function BodyLoginOnKeyDown(e) {

    if (event.keyCode == 13 && event.target.id =="bodyLogin") {

        var SmsLogin = getParameterByName("SmsLogin");
        var ForgotPassword = getParameterByName("ForgotPassword");
        var ForgotPasswordData = getParameterByName("ForgotPasswordData");

        if (SmsLogin == null && ForgotPassword == null && ForgotPasswordData == null) {
            btnLogin_Click();
        }
        else if (SmsLogin == "1") {
            btnSmsLogin_Click();
        }
        else if (ForgotPassword == "1") {
            btnForgotPassword_Click();
        }
        else if (ForgotPasswordData) {
            btnChangePasword_Click();
        }
    }
}

function UsernameKeyDown(e) {

    var keycode = (e.keyCode ? e.keyCode : e.which);

    if (keycode == 13) {
        e.preventDefault();
        btnLogin_Click();
    }

}

function UsernameKeyDownForgot(e) {

    var keycode = (e.keyCode ? e.keyCode : e.which);

    if (keycode == 13) {
        e.preventDefault();
        btnForgotPassword_Click();
    }

}

function SmsCodeKeyDown(e) {

    var keycode = (e.keyCode ? e.keyCode : e.which);

    if (keycode == 13) {
        e.preventDefault();
        btnSmsLogin_Click();
    }

}

function PasswordKeyPress(e) {

    var caps = isCapslock(e);

    if (caps == 1) {
        hideCapsLock();
    }
    else if (caps == 2) {
        showCapsLock();
    }

}

function PasswordKeyDown(e) {

    e = (e) ? e : window.event;

    var charCode = false;

    if (e.which) {
        charCode = e.which;
    } else if (e.keyCode) {
        charCode = e.keyCode;
    }

    if (charCode == 13) {
        e.preventDefault();
        btnLogin_Click();
    }
    else if (charCode == 20) {
        if (checkCapsLock()) {
            hideCapsLock();
        }
        else {
            showCapsLock();
        }
    }
}

function PasswordKeyDownForgot(e) {

    e = (e) ? e : window.event;

    var charCode = false;

    if (e.which) {
        charCode = e.which;
    } else if (e.keyCode) {
        charCode = e.keyCode;
    }

    if (charCode == 13) {
        e.preventDefault();
        btnForgotPassword_Click();
    }
    else if (charCode == 20) {
        if (checkCapsLock()) {
            hideCapsLock();
        }
        else {
            showCapsLock();
        }
    }
}

function PasswordKeyDownChange(e) {

    e = (e) ? e : window.event;

    var charCode = false;

    if (e.which) {
        charCode = e.which;
    } else if (e.keyCode) {
        charCode = e.keyCode;
    }

    if (charCode == 13) {
        e.preventDefault();
        btnChangePasword_Click();
    }
    else if (charCode == 20) {
        if (checkCapsLock()) {
            hideCapsLock();
        }
        else {
            showCapsLock();
        }
    }
}


function PasswordKeyBlur(e) {
    hideCapsLock();
}

function isCapslock(e) {

    e = (e) ? e : window.event;

    var charCode = false;
    if (e.which) {
        charCode = e.which;
    } else if (e.keyCode) {
        charCode = e.keyCode;
    }

    var shifton = false;
    if (e.shiftKey) {
        shifton = e.shiftKey;
    } else if (e.modifiers) {
        shifton = !!(e.modifiers & 4);
    }

    if (charCode >= 65 && charCode <= 90) {
        if (shifton)
            return 1;
        else
            return 2;
    }

    if (charCode >= 97 && charCode <= 122) {
        if (shifton)
            return 2;
        else
            return 1;
    }

    if (charCode == 214 || charCode == 199 || charCode == 350 || charCode == 304 || charCode == 286 || charCode == 220) {
        if (!shifton)
            return 2;
        else
            return 1;
    }

    if (charCode == 246 || charCode == 231 || charCode == 351 || charCode == 105 || charCode == 287 || charCode == 252) {
        if (shifton)
            return 2;
        else
            return 1;
    }

    return 0;
}

function checkCapsLock() {
    var capsLockText = $(".caps-lock");
    return !capsLockText.hasClass("caps-lock-hide");
}

function hideCapsLock() {

    var capsLockText = $(".caps-lock");

    if (!capsLockText.hasClass("caps-lock-hide"))
        capsLockText.addClass("caps-lock-hide");
}

function showCapsLock() {

    var capsLockText = $(".caps-lock");

    if (capsLockText.hasClass("caps-lock-hide"))
        capsLockText.removeClass("caps-lock-hide");

}

function GetRememberMe() {

    var elUsername = document.getElementById("tbxUsername");
    var elPassword = document.getElementById("tbxPassword");
    var elRememberMe = document.getElementById("cbxRememberMe");

    if (elRememberMe != null) {
        if (elUsername != null && elPassword != null) {

            var licenseeCompanyName = document.getElementById('licenseeCompanyName').innerText;

            if (localStorageCheck(licenseeCompanyName + "UserInfo")) {

                var userInfo = localStorageGet(licenseeCompanyName + "UserInfo");

                elUsername.value = userInfo.UserName;
                elPassword.value = userInfo.Password;
                elRememberMe.checked = true;

            } else {

                elUsername.value = "";
                elPassword.value = "";
                elRememberMe.checked = false;
            }
        }
    }
}

function SetRememberMe(rememberMe, username, password) {

    var licenseeCompanyName = document.getElementById('licenseeCompanyName').innerText;

    if (rememberMe) {
        localStorageSet(licenseeCompanyName + "UserInfo", { UserName: username, Password: password });
    } else {

        localStorageRemove(licenseeCompanyName + "UserInfo");
    }
}

function btnLogin_Click() {

    startLoading();

    var elUsername = document.getElementById("tbxUsername");
    var elPassword = document.getElementById("tbxPassword");
    var elRememberMe = document.getElementById("cbxRememberMe");
    var elchkLdap = document.getElementById("chkLdap");

    var username = elUsername ? elUsername.value : null;
    var password = elPassword ? elPassword.value : null;

    var rememberMe = false

    if (elRememberMe != null) {
        rememberMe = elRememberMe ? elRememberMe.checked : false;
    }

    var ldap = elchkLdap ? elchkLdap.checked : false;

    if (!username) {

        siiimpleToast.alert(LangErr.APP.ErrorUserName, {
            position: "top|right",
            duration: 7000,
        });
        stopLoading();
    }
    else if (!password) {
        siiimpleToast.alert(LangErr.APP.ErrorPassWord, {
            position: "top|right",
            duration: 7000,
        });
        stopLoading();
    }
    else {

        var loginData = { username: username, password: password, ldap: ldap };

        var loginDataJson = JSON.stringify(loginData);

        $.ajax({
            type: "POST",
            url: "login.aspx/LogIn",
            data: loginDataJson,
            contentType: "application/json;",
            dataType: "json",
            success: function (data) {

                data = data.d;
                data = JSON.parse(data);

                if (data && data.LoggedIn && !data.SMSLoggedIn && !data.FaceRecognitionLoggedIn && data.RedirectURL) {

                    window.location = data.RedirectURL;

                    SetRememberMe(rememberMe, username, password);
                }
                else if (data && data.IsExpirePassword && data.RedirectURL) {

                    UyumNotifySpecial(LangErr.APP.WarrningExpirePassword, null, 3);

                    UyumNotifySpecial(LangErr.APP.ErrorExpireLogin, null, 3);

                    setTimeout(function () { window.location = data.RedirectURL; }, 7000);

                }
                else if (data && !data.LoggedIn && (data.SMSLoggedIn || data.FaceRecognitionLoggedIn) && data.RedirectURL) {

                    window.location = data.RedirectURL;

                    SetRememberMe(rememberMe, username, password);
                }
                else if (data && (!data.LoggedIn || (!data.SMSLoggedIn && !data.FaceREcognitionLoggedIn))) {

                    UyumNotifySpecial(data.Message, null, 3);

                    stopLoading();
                }
                else if (data && (data.LoggedIn || data.SMSLoggedIn || data.FaceRecognitionLoggedIn) && !data.RedirectURL) {

                    UyumNotifySpecial('Sayfa bulunamadı.', null, 3);

                    stopLoading();

                } else {
                    stopLoading();
                }

            },
            error: function (jqXHR, textStatus, errorThrown) {

                console.log(jqXHR);

                console.log(textStatus);

                console.log(errorThrown);

                UyumNotifySpecial('Beklenmeyen bir hata oluştu.', null, 3);

                setTimeout(function () {
                    location.reload();
                }, 10100);

                stopLoading();
            }
        });
    }
}

function btnForgotPassword_Click() {

    startLoading();

    var elUsername = document.getElementById("tbxForgotUsername");
    var elEmail = document.getElementById("tbxEmail");

    var username = elUsername ? elUsername.value : null;
    var email = elEmail ? elEmail.value : null;

    if (!username) {
        siiimpleToast.alert(LangErr.APP.ErrorUserName, {
            position: "top|right",
            duration: 7000
        });
        stopLoading();
    }
    else if (!email) {
        siiimpleToast.alert(LangErr.APP.ErrorEmail, {
            position: "top|right",
            duration: 7000
        });
        stopLoading();
    }
    else {

        var loginData = { username: username, email: email };

        var loginDataJson = JSON.stringify(loginData);

        $.ajax({
            type: "POST",
            url: "login.aspx/ForgotPassword",
            data: loginDataJson,
            contentType: "application/json;",
            dataType: "json",
            success: function (data) {

                data = data.d;
                data = JSON.parse(data);

                if (data && data.IsSendEmail) {

                    UyumNotifySpecial(data.Message);

                }
                else if (data && !data.IsSendEmail) {

                    UyumNotifySpecial(data.Message);

                    stopLoading();
                }
                else if (data && data.IsSendEmail && !data.RedirectURL) {

                    UyumNotifySpecial('Sayfa bulunamadı.', null, 3);

                    stopLoading();
                } else {
                    stopLoading();
                }

            },
            error: function (jqXHR, textStatus, errorThrown) {

                UyumNotifySpecial('Beklenmeyen bir hata oluştu.', null, 3);

                setTimeout(function () {
                    location.reload();
                }, 10100);

                stopLoading();
            }
        });
    }
}

function btnChangePasword_Click() {

    if (!ControlStrength()) {
        alert(LangErr.APP.ErrorPasswordStrength);
        return false;
    }

    startLoading();

    var elPassword1 = document.getElementById("tbxPassword1");
    var elPassword2 = document.getElementById("tbxPassword2");
    var elUserId = document.getElementById("hdnUserId");

    var password1 = elPassword1 ? elPassword1.value : null;
    var password2 = elPassword2 ? elPassword2.value : null;
    var userId = elUserId ? elUserId.value : null;

    if (!password1) {
        siiimpleToast.alert(LangErr.APP.ErrorPassWord, {
            position: "top|right",
            duration: 7000
        });
        stopLoading();
    }
    else if (!password2) {
        siiimpleToast.alert(LangErr.APP.ErrorConfirmPassWord, {
            position: "top|right",
            duration: 7000
        });
        stopLoading();
    }
    else if (!userId) {
        siiimpleToast.alert(LangErr.APP.ErrorUserNotFound, {
            position: "top|right",
            duration: 7000
        });
        stopLoading();
    }
    else if (password1 != password2) {
        siiimpleToast.alert(LangErr.APP.ErrorPasswordNotMatch, {
            position: "top|right",
            duration: 7000
        });
        stopLoading();
    }
    else {

        var loginData = { password1: password1, password2: password2, userId: userId };

        var loginDataJson = JSON.stringify(loginData);

        $.ajax({
            type: "POST",
            url: "login.aspx/ChangePasword",
            data: loginDataJson,
            contentType: "application/json;",
            dataType: "json",
            success: function (data) {

                data = data.d;
                data = JSON.parse(data);

                if (data && data.IsChangePassword && data.RedirectURL) {

                    UyumNotifySpecial(data.Message);

                    setTimeout(function () {
                        window.location = data.RedirectURL;
                    }, 4000);

                }
                else if (data && !data.IsChangePassword) {

                    UyumNotifySpecial(data.Message);

                    stopLoading();
                }
                else if (data && data.IsChangePassword && !data.RedirectURL) {

                    UyumNotifySpecial('Sayfa bulunamadı.');

                    stopLoading();
                } else {
                    stopLoading();
                }

            },
            error: function (jqXHR, textStatus, errorThrown) {

                UyumNotifySpecial('Beklenmeyen bir hata oluştu.');

                setTimeout(function () {
                    location.reload();
                }, 10100);

                stopLoading();
            }
        });
    }
}

function btnSmsLogin_Click() {

        startLoading("btnSmsLogin", "cbpSmsLoginForm");

        var elSmsCode = document.getElementById("tbxSmsCode");

        var SmsCode = elSmsCode ? elSmsCode.value : null;

        if (!SmsCode) {
            siiimpleToast.alert(LangErr.APP.ErrorSmsCode, {
                position: "top|right",
                duration: 7000,
            });
            stopLoading("btnSmsLogin", "cbpSmsLoginForm");
        }
        else {

            var loginData = { smsCode: SmsCode };

            var loginDataJson = JSON.stringify(loginData);

            $.ajax({
                type: "POST",
                url: "login.aspx/SmsLogin",
                data: loginDataJson,
                contentType: "application/json;",
                dataType: "json",
                success: function (data) {

                    data = data.d;
                    data = JSON.parse(data);

                    if (data && data.IsLogin && data.RedirectURL) {

                        window.location = data.RedirectURL;
                    }
                    else if (data && data.IsExpirePassword && data.RedirectURL) {

                        window.location = data.RedirectURL;
                    }
                    else if (data && !data.IsLogin && data.IsRetrayLogin) {

                        UyumNotifySpecial(data.Message);

                        stopLoading("btnSmsLogin", "cbpSmsLoginForm");

                        setTimeout(function () { window.location = data.RedirectURL; }, 3000);
                    }
                    else if (data && !data.IsLogin) {

                        UyumNotifySpecial(data.Message, null, 3);

                        stopLoading("btnSmsLogin", "cbpSmsLoginForm");
                    }
                    else if (data && data.IsLogin && !data.RedirectURL) {

                        UyumNotifySpecial('Sayfa bulunamadı.', null, 3);

                        stopLoading("btnSmsLogin", "cbpSmsLoginForm");
                    } else {
                        stopLoading("btnSmsLogin", "cbpSmsLoginForm");
                    }

                },
                error: function (jqXHR, textStatus, errorThrown) {

                    console.log(jqXHR);
                    console.log(textStatus);
                    console.log(errorThrown);

                    UyumNotifySpecial('Beklenmeyen bir hata oluştu.', null, 3);

                    setTimeout(function () {
                        location.reload();
                    }, 10100);

                    stopLoading("btnSmsLogin", "cbpSmsLoginForm");
                }
            });
        }
}

function btnCancel_Click() {
    window.location = "login.aspx";
}

function startLoading(btnName, frmName) {

    formDisable(true, btnName, frmName);

    $(".loader-bottom").addClass("start");

    setTimeout(function () {
        $(".loader-top").addClass("start");
    }, 300);
}

function stopLoading(btnName, frmName) {

    formDisable(false, btnName, frmName);

    setTimeout(function () {
        $(".loader-top").removeClass("start");
        $(".loader-bottom").removeClass("start");
    }, 400);
}

function formDisable(disable, btnName, frmName) {

    var btn = $("#btnLogin");
    var frm = $("#cbpLoginForm");

    if (btnName != undefined && btnName != null) {
        btn = $("#" + btnName);
    }

    if (frmName != undefined && frmName != null) {
        frm = $("#" + frmName);
    }

    if (disable) {
        btn.addClass("loading");
        frm.css('pointer-events', 'none');
    } else {
        btn.removeClass("loading");
        frm.css('pointer-events', 'inherit');
    }
}

function fullscreenPop(POPurl) {
    window.open(POPurl, '', 'fullscreen,menubar=1,toolbar=1');
}

function bodyLoginOnload() {

    SetCountryCode();

    SetLdap();

    SetWidthHeight();

    var bodyObj = document.getElementById("bodyLogin");
    if (bodyObj) {
        var divObj = bodyObj.getElementsByTagName("div");
        if (divObj != null && divObj.length > 0 && divObj.item(0).style.zIndex == 100000) {
            divObj.item(0).style.display = "none";
        }
        else
            if (divObj != null && divObj.length > 1 && divObj.item(1).style.zIndex == 100000) {
                divObj.item(1).style.display = "none";
            }
    }

    ControlLoginParent();
}

function SetLdap() {

    var chkLdap = document.getElementById("chkLdap");

    if (chkLdap != null) {
        var ldap = chkLdap.checked;

        if (localStorageCheck(window.location.host + "LDAP")) {

            var ldapDb = localStorageGet(window.location.host + "LDAP");

            if (ldap != ldapDb) {

                document.getElementById("chkLdap").checked = ldapDb;
            }
        }
    }
}

function SetCountryCode() {

    var country_code = document.getElementById("LangInfo").value;

    var country_codeLocalDb = readCookie("CountryCode");

    if (country_codeLocalDb != undefined && country_codeLocalDb != null && !country_codeLocalDb.startsWith(country_code)) {

        changeCountry(country_codeLocalDb);
    }

    var i = 0;
    var indexNumber = 0;

    $("#countries option").each(function () {
        if ($(this).val() == country_code) {
            indexNumber = i;
        }
        i++;
    });
    var oHandler = $('#countries').msDropDown().data("dd");
    if (oHandler) {
        oHandler.set("selectedIndex", indexNumber);
    }
}

function ControlLoginParent() {

    if (parent.document.location.href != window.location.href) {

        GetParentLoginWindows(window);
    }
}

function GetParentLoginWindows(page) {

    if (page.parent.document.location.href != page.window.location.href) {

        GetParentLoginWindows(page.parent);
    }
    else {

        console.log("Üst pencere login gönderilecek : " + page.parent.document.location.href);

        page.parent.document.location.href = "login.aspx";
    }
}

function SetWidthHeight() {

    var height = $(window).height();
    var width = $(window).width();

    $.ajax({
        url: "WindowSize.ashx",
        data: {
            'Height': height,
            'Width': width
        },
        contentType: "application/json; charset=utf-8",
        dataType: "json"
    }).done(function (data) {

    }).fail(function (xhr) {
        console.log("Ekran bilgileri yazılamadı.");

        console.log(xhr);

    });

}

function changeCountry(selectedCountry) {

    startLoading();

    $.ajax({
        type: "POST",
        url: "login.aspx/ChangedCountry",
        data: "{ 'countryCode' : '" + selectedCountry + "' }",
        contentType: "application/json;",
        dataType: "json",
        success: function (resultCountry) {

            startLoading();

            var resultLang = resultCountry.d;
            resultLang = JSON.parse(resultLang);

            createCookie("CountryCode", resultLang.LangInfo, 999);

            location.reload();

            stopLoading();
        },
        error: function (jqXHR, textStatus, errorThrown) {

            UyumNotifySpecial('Beklenmeyen bir hata oluştu.', null, 3);

            console.log(textStatus);

            UyumNotifySpecial(jqXHR.responseJSON.Message, null, 3);

            stopLoading();
        }
    });

}

function ldap_OnChange() {

    var chkLdap = document.getElementById("chkLdap");

    if (chkLdap != null) {
        var ldap = chkLdap.checked;

        localStorageSet(window.location.host + "LDAP", ldap);
    }
}

//#region Login >> Face Recognition

var width = 320;
var height = 0;

var streaming = false;

var video = null;
var canvas = null;
var photo = null;

function cameraStartup() {
    video = document.getElementById('video');
    canvas = document.getElementById('canvas');
    photo = document.getElementById('photo');

    navigator.mediaDevices.getUserMedia({ video: true, audio: false })
        .then(function (stream) {
            video.srcObject = stream;
            video.play();
        })
        .catch(function (err) {
            console.log("An error occurred: " + err);
        });

    video.addEventListener('canplay', function (ev) {
        if (!streaming) {
            height = video.videoHeight / (video.videoWidth / width);

            // Firefox currently has a bug where the height can't be read from
            // the video, so we will make assumptions if this happens.

            if (isNaN(height)) {
                height = width / (4 / 3);
            }

            video.setAttribute('width', width);
            video.setAttribute('height', height);
            canvas.setAttribute('width', width);
            canvas.setAttribute('height', height);
            streaming = true;
        }
    }, false);

    clearphoto();
}

// Fill the photo with an indication that none has been
// captured.

function clearphoto() {
    var context = canvas.getContext('2d');
    context.fillStyle = "#AAA";
    context.fillRect(0, 0, canvas.width, canvas.height);

    var data = canvas.toDataURL('image/png');
    photo.setAttribute('src', data);
}

// Capture a photo by fetching the current contents of the video
// and drawing it into a canvas, then converting that to a PNG
// format data URL. By drawing it on an offscreen canvas and then
// drawing that to the screen, we can change its size and/or apply
// other changes before drawing it.

function takepicture() {
    var context = canvas.getContext('2d');
    if (width && height) {
        canvas.width = width;
        canvas.height = height;
        context.drawImage(video, 0, 0, width, height);

        var data = canvas.toDataURL('image/jpeg');
        photo.setAttribute('src', data);
        btnFaceRecognitionLogin_Click(data);
    } else {
        clearphoto();
    }
}


function OpenCamera() {
    cameraStartup();
}


function btnFaceRecognitionLogin_Click(imageBase64) {

    startLoading("btnFaceRecognitionLogin", "cbpFaceRecognitionLoginForm");

    $.ajax({
        type: "POST",
        url: "login.aspx/FaceRecognitionLogin",
        data: "{ 'faceRecognitionImage' : '" + imageBase64 + "'  }",
        contentType: "application/json;",
        dataType: "json",
        success: function (data) {

            data = data.d;
            data = JSON.parse(data);

            if (data && data.IsLogin && data.RedirectURL) {

                window.location = data.RedirectURL;
            }
            else if (data && !data.IsLogin && data.IsRetrayLogin) {

                stopLoading("btnFaceRecognitionLogin", "cbpFaceRecognitionLoginForm");

                UyumNotifySpecial(data.Message, null, 3);

                setTimeout(function () { window.location = data.RedirectURL; }, 3000);
            }
            else if (data && !data.IsLogin) {

                stopLoading("btnFaceRecognitionLogin", "cbpFaceRecognitionLoginForm");

                UyumNotifySpecial(data.Message, null, 3);
            }
            else if (data && data.IsLogin && !data.RedirectURL) {

                stopLoading("btnFaceRecognitionLogin", "cbpFaceRecognitionLoginForm");

                UyumNotifySpecial('Sayfa bulunamadı.', null, 3);

            } else {
                stopLoading("btnFaceRecognitionLogin", "cbpFaceRecognitionLoginForm");
            }

        },
        error: function (jqXHR, textStatus, errorThrown) {
            stopLoading("btnFaceRecognitionLogin", "cbpFaceRecognitionLoginForm");

            UyumNotifySpecial('Beklenmeyen bir hata oluştu.', null, 3);

            setTimeout(function () {
                location.reload();
            }, 10100);

        }
    });

}

//#endregion

function OpenMobileSettings() {

    var licenseeCompanyName = document.getElementById('licenseeCompanyName').innerText;

    var userName = '';
    var password = '';

    if (localStorageCheck(licenseeCompanyName + "UserInfo")) {

        var userInfo = localStorageGet(licenseeCompanyName + "UserInfo");

        userName = userInfo.UserName;
        password = userInfo.Password;
    }

    var openUrl = '/WebGeneral/MobileSettings.aspx?UserName=' + encodeURI(userName) + "&Password=" + encodeURI(password);

    UyumDialog.Open(openUrl, null, 30, 45);

    UyumDialogPopup.SetHeaderText('QR');
    UyumDialogPopup.allowResize = false;
}